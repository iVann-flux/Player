<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js"></script>
  <style>
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
    #video-container { width: 100%; height: 100%; }
    video { width: 100%; height: 100%; outline: none; }
    .shaka-range-element { color: #007bff !important; }
  </style>
</head>
<body>

  <div data-shaka-player-container id="video-container">
    <!-- এখানে controls এট্রিবিউট নেই, তাই ডাবল UI আসবে না -->
    <video autoplay playsinline id="video" data-shaka-player-display></video>
  </div>

  <script>
    // URL থেকে ডাটা নেওয়ার লজিক
    const params = new URLSearchParams(window.location.search);
    const streamUrl = params.get('play'); // 'play' প্যারামিটার থেকে লিঙ্ক নেবে
    const keyId = params.get('k1');      // 'k1' থেকে Key ID নেবে
    const keyVal = params.get('k2');     // 'k2' থেকে Key Value নেবে

    async function init() {
      const video = document.getElementById('video');
      const container = document.getElementById('video-container');
      const player = new shaka.Player(video);
      const ui = new shaka.ui.Overlay(player, container, video);

      ui.configure({
        'controlPanelElements': ['play_pause', 'mute', 'volume', 'time_and_duration', 'spacer', 'quality', 'fullscreen']
      });

      // যদি URL-এ Key থাকে তবেই DRM কনফিগার করবে
      if (keyId && keyVal) {
        player.configure({
          drm: {
            clearKeys: { [keyId]: keyVal }
          }
        });
      }

      player.configure({
        streaming: { lowLatencyMode: true }
      });

      try {
        if (streamUrl) {
          await player.load(streamUrl);
          console.log('Video loaded!');
        } else {
          console.error('No stream URL provided in parameters.');
        }
      } catch (error) {
        console.error('Error loading video', error);
      }
    }

    document.addEventListener('shaka-ui-loaded', init);
    
    // অটো-প্লে ফিক্স
    window.addEventListener('click', () => {
        const v = document.getElementById('video');
        if(v.muted) { v.muted = false; }
    }, {once: true});
  </script>
</body>
</html>
